#{extends 'main.html' /}

#{set title:'Play video' /}

<div class="page-header">
    <h1>Video ${id}</h1>
</div>
<div>
    Delay (&ge; 5) <input id="delay" style="width: 60px;text-align: center" type="text" placeholder="5" value="5"/>
</div>
<div id="player"></div>
<div id="slideHandler">
    <input id="autoslide" type="checkbox" checked="checked"/> Automatically slide
</div>
<div id="timeline"></div>
#{set 'moreStyles'}

#{/set}
<script src="/public/js/timeline.js"></script>
<script>
    var player;
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '390',
            width: '640',
            videoId: 'WLV623pf1_M',
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    function onPlayerReady(event) {

    }

    var done = false;
    function onPlayerStateChange(event) {
        if (event.data === 1){  //if the video is playing start catching events
            checkTimePointsOnVideo();
        }
    }


    /** not used yet **//*
    function catchNextMoment(points){
        *//* catches the next timepoint *//*
        var played = Math.round(player.getCurrentTime()),
                i=0,
                point = 0;
        for (i=0; point = points[i]; i++) {
            if (point === played) {
                console.log("in");
                slideTimeline(played);
                *//* !!!! call time line method*//*
                $("#result").text("Reached "+point + "!");
                break;
            }
        }
    }

    var points = [1, 2, 3, 5, 10, 13, 15, 20];*/


    /* !!!contains timer that runs slideTimeline */
    function checkTimePointsOnVideo() {

        addTimeToPanel();

        /* catches all timepoints on the video*/
        if (!player.getCurrentTime) {
            return false;
        }

        // player.getPlayerState() ----- Possible values are unstarted (-1), ended (0), playing (1), paused (2), buffering (3), video cued (5).
        var interval = setInterval(function(){
            if(player.getPlayerState() === 1) {
                var played = Math.round(player.getCurrentTime());
                console.log("CurrentTime:"+played+"s");
                slideTimeline(played);
            } else if(player.getPlayerState() === 0 || player.getPlayerState() === 2) {
                clearInterval(interval);
            }
        },1000);
    }

    function stopVideo() {
        player.stopVideo();
    }

</script>