package controllers;

import play.*;
import play.mvc.*;

import java.util.*;

import Model.User;

import models.*;

public class Application extends Controller {

    public static void index() {
        render();
    }
    // checking if email and password are OK
    public static void authenticate(String email, String password) {
        User user = User.findByEmail(email);
       if (user == null || !user.checkPassword(password)) {
        	System.out.println("not successfully");
            flash.error("Bad email or bad password");
            flash.put("email", email);
            // redirect somewhere
        } 
        connect(user);
        flash.success("Welcome %s !", user.name);
        //redirect somewhere
    }
      // creating a session 
      static void connect(User user) {
        session.put("logged", user.id);
    }
      // get the user which is logged ON
      static User connectedUser() {
	        String userId = session.get("logged");
	        return userId == null ? null : (User) User.findById(Long.parseLong(userId));
	    }
      public static void login() {
	      	  //render();
	    }
      //logout
      public static void logout() {

	        flash.success("You've been logged out");
	        session.clear();
	       //redirect to main page or to logout page
      }
      //register
      public static void register(@Required String name, @Required String surname, @Required String occupation ,@Required @Email String email, @Required String monIncome, @Required String password , @Equals("password") String password2, @Required String gender, @Required String mon,  @Required String year) {
	        if (validation.hasErrors() || User.findByEmail(email)!=null) {
	            validation.keep();
	            params.flash();
	            String error="";
	            if (User.findByEmail(email)!=null)
	            
	            	{
	            	 ErrCode=2;
	            	
	            	
	            	}
	            else
	            {
	            	ErrCode=1;
	            	
	            }
	            	
	         //   render(error);
	          //  System.out.println("name:"+name);
	     //       System.out.println("surname:"+surname);
	     //       System.out.println("email:"+email);
	     //       System.out.println("pass:"+password);
	    //        System.out.println("pass2:"+password2);
	    //        System.out.println("gender:"+gender);
	    //        System.out.println("occupation:"+occupation);
	   //         System.out.println("monIncome:"+monIncome);
	   //         System.out.println("birthdate"+mon+"  "+ year);
	          //  System.out.println("error");
	        //    System.out.println(validation.errors().size());	
	            signup();
	        }
	        else
	        {
	         ErrCode=0;
	        long mm=Long.parseLong(monIncome.split("-")[1]);
	        Date a= new Date(Integer.parseInt(year),Integer.parseInt(mon),1);
	        User user = new User(name+" "+surname, occupation, email, mm, a, gender, password);
	        user.save();
	        
	        Successfull();
	        }
	       
	    }
}